<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center p-3">
    <h3 class="mb-0">Customer Detail</h3>
    <div class="d-flex justify-content-end" *ngIf="customer$ | async as c; else loading">
      <a [routerLink]="['/edit-customer', c.id]" class="btn btn-outline-success me-2">Edit</a>
      <a routerLink="/all-customers" class="btn btn-outline-primary me-2">Back</a>
    </div>
  </div>
  @if (errorMessage) {
    <div class="alert alert-warning">{{ errorMessage }}</div>
  }

  <div class="row g-3">
    <div class="col-md-4">
      <div class="card shadow-sm" *ngIf="customer$ | async as c; else loading">
        <div class="card-header">Profile</div>
        <div class="card-body">
          <p><strong>ID:</strong> {{ c.id }}</p>
          <p><strong>Name:</strong> {{ c.name }}</p>
          <p><strong>Username:</strong> {{ c.username }}</p>
          <p><strong>Role:</strong> {{ c.role }}</p>
          <p><strong>Active:</strong> {{ c.isActive ? 'Yes' : 'No' }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-8">
      <div class="row g-3 align-items-start">
        <div class="card shadow-sm mb-3">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span>Active Rental</span>
          </div>
          <div class="card-body">
            @if (activeRentals$ | async; as ar) {
              @for (rental of ar.rentals; track rental.id) {
                <div class="row g-3 align-items-start">
                  <!-- Rental Details -->
                  <div class="col-md-6">
                    <div class="border rounded p-3 h-100">
                      <p class="mb-1"><strong>Equipment:</strong> {{ rental.equipmentName }}</p>
                      <p class="mb-1"><strong>Issued:</strong> {{ rental.issuedAt | date : 'mediumDate' }}</p>
                      <p class="mb-1"><strong>Due:</strong> {{ rental.dueDate | date : 'mediumDate' }}</p>
                      <a [routerLink]="['/return-rental', rental.id]" class="btn btn-warning mt-2">Return</a>
                    </div>
                  </div>

                  <!-- Image Card -->
                  <div class="col-md-6 d-flex justify-content-center">
                    <div class="card shadow-sm" style="width: 18rem;">
                      <img src="/images/hammer.jpg" class="card-img-top" alt="hammer logo" height="200" width="200">
                    </div>
                  </div>
                </div>
              }
            } @else {
              <div class="text-muted">No active rentals found.</div>
            }
          </div>
        </div>

      </div>
      <div class="card shadow-sm">
        <div class="card-header">Rental History</div>
        <div class="card-body">
          @if (customerRentals$ | async; as cr) {
            @for (rental of cr.rentals; track rental.id) {
              <div class="table-responsive">
                <table class="table table-hover table-striped-columns table-bordered table-sm">
                  <thead>
                  <tr>
                    <th>Rental Id</th>
                    <th>Equipment</th>
                    <th>Status</th>
                    <th>Issued</th>
                    <th>Due</th>
                    <th>Returned</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr>
                    <td>{{ rental.id }}</td>
                    <td>{{ rental.equipmentName }}</td>
                    <td>{{ rental.equipmentStatus }}</td>
                    <td>{{ rental.issuedAt | date : 'mediumDate' }}</td>
                    <td>{{ rental.dueDate | date : 'mediumDate' }}</td>
                    <td>{{ rental.returnedAt ? (rental.returnedAt | date : 'mediumDate') : '-' }}</td>
                  </tr>
                  </tbody>
                </table>
              </div>
            }
          }@else{
           <div class="text-muted">
              No rentals found.
            </div>
           }
        </div>
      </div>
    </div>
  </div>
</div>
<ng-template #loading>
  <div class="container mt-4">Loading...</div>
</ng-template>
